---
import { themeConfig } from '@/config'
---

{
  themeConfig.general.themeToggle && (
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
      <svg
        class="icon sun-icon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="12" r="5" />
        <line x1="12" y1="1" x2="12" y2="3" />
        <line x1="12" y1="21" x2="12" y2="23" />
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
        <line x1="1" y1="12" x2="3" y2="12" />
        <line x1="21" y1="12" x2="23" y2="12" />
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
      </svg>
      <svg
        class="icon moon-icon"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
      </svg>
    </button>
  )
}

<script is:inline>
  function bindThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle')
    if (themeToggle && window.ThemeManager) {
      // Remove existing event listeners to prevent duplicates
      const newToggle = themeToggle.cloneNode(true)
      themeToggle.parentNode.replaceChild(newToggle, themeToggle)

      newToggle.addEventListener('click', function (e) {
        e.preventDefault()
        e.stopPropagation()
        window.ThemeManager.toggle()
      })
    }
  }

  // Bind on initial load
  window.addEventListener('DOMContentLoaded', bindThemeToggle)

  // Bind on Astro page transitions
  document.addEventListener('astro:page-load', bindThemeToggle)
</script>

<style>
  .theme-toggle {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 1.5rem;
    width: 1.5rem;
    padding: 0;
    color: var(--text-primary);
    opacity: 0.6;
    transition:
      opacity 0.2s ease,
      color 0.2s ease;
  }

  .theme-toggle:hover {
    opacity: 1;
  }

  .icon {
    width: 1rem;
    height: 1rem;
  }

  .sun-icon {
    display: block;
  }
  .moon-icon {
    display: none;
  }

  :global(html.dark) .sun-icon {
    display: none;
  }
  :global(html.dark) .moon-icon {
    display: block;
  }
</style>
